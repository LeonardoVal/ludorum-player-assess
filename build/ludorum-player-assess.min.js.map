{"version":3,"sources":["../src/__prologue__.js","../src/hypothesis-testing.js","../src/__epilogue__.js"],"names":["__init__","base","Sermat","ludorum","raiseIf","exports","__package__","__name__","__dependencies__","__SERMAT__","include","compare","args","game","intervalId","player1","players","RandomPlayer","name","player2","opponents","matchCount","logger","contest1","tournaments","Measurement","contest2","info","matchesPlayed","forEach","contest","events","on","setInterval","logTime","Future","all","run","then","result","role","stats1","statistics","stats2","count","key","player","r","clearInterval","hypergeometricRule","row1","row2","n","rowSums","colSums","map","v","i","factors","Array","concat","x","fi","di","Math","pow","fisher2x2","alpha","length","isNaN","a","b","c","d","r1","r2","c1","c2","cutoff","abs","max_a","min","p_value","comparison","fisher2x3","p","e","f","c3","row"],"mappings":"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","file":"ludorum-player-assess.min.js","sourcesContent":["/** Library wrapper and layout.\n*/\nfunction __init__(base, Sermat, ludorum) { \"use strict\";\n// Import synonyms. ////////////////////////////////////////////////////////////////////////////////\n\tvar raiseIf = base.raiseIf;\n\n// Library layout. /////////////////////////////////////////////////////////////////////////////////\n\tvar exports = {\n\t\t\t__package__: 'ludorum-player-assess',\n\t\t\t__name__: 'ludorum_player_assess',\n\t\t\t__init__: __init__,\n\t\t\t__dependencies__: [base, Sermat], ludorum,\n\t\t\t__SERMAT__: { include: [base, ludorum] }\n\t\t}\n\t;","/** # Independence test\n\nPlayer performance comparisons and tests based on hypothesis testing.\n*/\n\nexports.compare = function compare(args) {\n    raiseIf(!args || !args.game, \"Missing `game` argument!\");\n    var game = args.game,\n        player1 = args.player1 || new ludorum.players.RandomPlayer({ name: 'RandomPlayer1' }),\n        player2 = args.player2 || new ludorum.players.RandomPlayer({ name: 'RandomPlayer2' }),\n\t    opponents = args.opponents || [new ludorum.players.RandomPlayer({ name: 'RandomOpponent' })],\n        matchCount = +args.matchCount || 400,\n        logger = args.logger,\n        contest1 = new ludorum.tournaments.Measurement(game, player1, opponents, matchCount),\n        contest2 = new ludorum.tournaments.Measurement(game, player2, opponents, matchCount),\n        intervalId;\n    if (logger) {\n        logger.info(\"Starting \"+ matchCount*4 +\" matches of \"+ game.name +\".\");\n        var matchesPlayed = 0;\n        [contest1, contest2].forEach(function (contest) { \n            contest.events.on('afterMatch', function () {\n                matchesPlayed++;\n            });\n        });\n        intervalId = setInterval(function () {\n\t\t\tlogger.info(\"Played \"+ matchesPlayed +\"/\"+ matchCount*4 +\" matches.\");\n\t\t}, args.logTime || 20000);\n    }\n\treturn base.Future.all([contest1.run(), contest2.run()]).then(function () {\n\t\tvar result = {};\n\t\tgame.players.forEach(function (role) {\n\t\t\tvar stats1 = contest1.statistics,\n\t\t\t\tstats2 = contest2.statistics;\n\t\t\t(result[player1.name] || (result[player1.name] = {}))[role] = [\n\t\t\t\tstats1.count({ key: 'victories', role: role, player: player1.name }),\n\t\t\t\tstats1.count({ key: 'draws', role: role, player: player1.name }),\n\t\t\t\tstats1.count({ key: 'defeats', role: role, player: player1.name })\n\t\t\t];\n\t\t\t(result[player2.name] || (result[player2.name] = {}))[role] = [\n\t\t\t\tstats2.count({ key: 'victories', role: role, player: player2.name }),\n\t\t\t\tstats2.count({ key: 'draws', role: role, player: player2.name }),\n\t\t\t\tstats2.count({ key: 'defeats', role: role, player: player2.name })\n\t\t\t];\n\t\t});\n\t\treturn result;\n\t}).then(function (r) {\n        if (logger) {\n            clearInterval(intervalId);\n            logger.info(\"Played \"+ matchesPlayed +\"/\"+ matchCount +\" matches.\");\n        }\n        return r;\n    });\n};\n\n// ## Fisher exact test ############################################################################\n\nvar hypergeometricRule = exports.hypergeometricRule = function hypergeometricRule(row1, row2) {\n    var n = 0,\n        rowSums = [0, 0],\n        colSums = row1.map(function (v, i) {\n            rowSums[0] += v;\n            rowSums[1] += row2[i];\n            n += v + row2[i];\n            return v + row2[i];\n        });\n    var factors = new Array(n + 1);\n    rowSums.concat(colSums).forEach(function (x) {\n        for (var i = 2; i <= x; i++) {\n            factors[i] = (factors[i] |0) + 1;\n        }\n    });\n    [n].concat(row1, row2).forEach(function (x) {\n        for (var i = 2; i <= x; i++) {\n            factors[i] = (factors[i] |0) - 1;\n        }\n    });\n    var r = 1;\n    for (var fi = 2, di = 2; fi <= n || di <= n; ) {\n        if (r <= 1 && fi <= n) {\n            if (factors[fi] > 0) {\n                r *= Math.pow(fi, factors[fi]);\n            }\n            fi++;\n        } else {\n            if (factors[di] < 0) {\n                r *= Math.pow(di, factors[di]);\n            }\n            di++;\n        }\n    }\n    return r;\n};\n\nexports.fisher2x2 = function fisher2x2(row1, row2, alpha) {\n    raiseIf(row1.length !== 2 || row2.length !== 2, \"Contingency table should be 2x2!\");\n    alpha = isNaN(alpha) ? 0.05 : +alpha;\n    var a = row1[0], b = row1[1],\n        c = row2[0], d = row2[1],\n        r1 = a + b, r2 = c + d,\n        c1 = a + c, c2 = b + d,\n        cutoff = Math.abs(a / r1 - c / r2),\n        max_a = Math.min(c1, r1),\n        p_value = 0,\n        disprop;\n    for (a = 0; a <= max_a; a++) {\n        b = r1 - a;\n        c = c1 - a;\n        d = c2 - b;\n        disprop = Math.abs(a / r1 - c / r2);\n        if (disprop >= cutoff) {\n            p_value += hypergeometricRule([a, b], [c, d]);\n        }\n    }\n    return {\n        p_value: p_value,\n        comparison: p_value > alpha ? 0 : (row1[0] - row2[0])\n    };\n};\n\nexports.fisher2x3 = function fisher2x3(row1, row2, alpha) {\n    raiseIf(row1.length !== 3 || row2.length !== 3, \"Contingency table should be 2x3!\");\n    alpha = isNaN(alpha) ? 0.05 : +alpha;\n    var a = row1[0], b = row1[1], c = row1[2],\n        d = row2[0], e = row2[1], f = row2[2],\n        r1 = a + b + c, r2 = d + e + f,\n        c1 = a + d, c2 = b + e, c3 = c + f,\n        cutoff = hypergeometricRule([a, b, c], [d, e, f]),\n        p_value = 0,\n        p;\n    for (a = 0; a <= r1; a++) {\n        for (b = 0; b <= r1 - a; b++) {\n            c = r1 - a - b;\n            d = c1 - a;\n            e = c2 - b;\n            f = c3 - c;\n            p = hypergeometricRule([a, b, c], [d, e, f]);\n            if (p <= cutoff) {\n                p_value += p;\n            }\n        }\n    }\n    return {\n        p_value: p_value,\n        comparison: p_value > alpha ? 0 : (row1[0] - row2[0] || (row1[1] - row[1]) / (c2 + 1))\n    };\n};","// See __prologue__.js\n\treturn exports;\n}\n"]}