//! ludorum-player-assess 0.0.1

(function(e){"use strict";"function"==typeof define&&define.amd?define(["creatartis-base","sermat","ludorum"],e):"object"==typeof exports&&module.exports?module.exports=e(require("creatartis-base"),require("sermat"),require("ludorum")):this["ludorum-player-assess"]=e(this.base,this.Sermat,this.ludorum)}).call(this,function e(n,r,t){"use strict";var a=n.raiseIf,o={__package__:"ludorum-player-assess",__name__:"ludorum_player_assess",__init__:e,__dependencies__:[n,r],ludorum:t,__SERMAT__:{include:[n,t]}},u=o.statistics={};o.compare=function(e){a(!e||!e.game,"Missing `game` argument!");var r,o=e.game,u=e.players||[new t.players.RandomPlayer({name:"RandomPlayer"})],i=e.opponents||[new t.players.RandomPlayer({name:"RandomOpponent"})],s=+e.matchCount||400,c=e.logger,l=u.map(function(e){return new t.tournaments.Measurement(o,e,i,s)});if(c){c.info("Starting "+s*u.length*2+" matches of "+o.name+".");var m=0;l.forEach(function(e){e.events.on("afterMatch",function(){m++})}),r=setInterval(function(){c.info("Played "+m+"/"+s*u.length*2+" matches.")},e.logTime||2e4)}return n.Future.all(l.map(function(e){return e.run()})).then(function(){return l.map(function(e,r){var t=e.statistics,a=u[r],i=n.iterable(o.players).map(function(e){return[e,[t.count({key:"victories",role:e,player:a.name}),t.count({key:"draws",role:e,player:a.name}),t.count({key:"defeats",role:e,player:a.name})]]}).toObject();return i.player=a.name,i})}).then(function(e){return c&&(clearInterval(r),c.info("Played "+m+"/"+s*u.length*2+" matches.")),e})};var i=u.hypergeometricRule=function(e,n){var r=0,t=[0,0],a=e.map(function(e,a){return t[0]+=e,t[1]+=n[a],r+=e+n[a],e+n[a]}),o=new Array(r+1);t.concat(a).forEach(function(e){for(var n=2;n<=e;n++)o[n]=1+(0|o[n])}),[r].concat(e,n).forEach(function(e){for(var n=2;n<=e;n++)o[n]=(0|o[n])-1});for(var u=1,i=2,s=2;i<=r||s<=r;)u<=1&&i<=r?(o[i]>0&&(u*=Math.pow(i,o[i])),i++):(o[s]<0&&(u*=Math.pow(s,o[s])),s++);return u};return u.fisher2x2=function(e,n,r){a(2!==e.length||2!==n.length,"Contingency table should be 2x2!"),r=isNaN(r)?.05:+r;var t=e[0],o=e[1],u=n[0],s=n[1],c=t+o,l=u+s,m=t+u,f=Math.abs(t/c-u/l),p=Math.min(c,m),h=0;for(t=0;t<=p;t++)o=c-t,(s=l-(u=m-t))>=0&&Math.abs(t/c-u/l)>=f&&(h+=i([t,o],[u,s]));return{p_value:h,comparison:h>r?0:e[0]-n[0]}},u.fisher2x3=function(e,n,r){a(3!==e.length||3!==n.length,"Contingency table should be 2x3!"),r=isNaN(r)?.05:+r;var t,o,u=e[0],s=e[1],c=e[2],l=n[0],m=n[1],f=n[2],p=u+s+c,h=u+l,d=s+m,y=c+f,_=i([u,s,c],[l,m,f]),g=Math.min(p,h),v=0;for(u=0;u<=g;u++)for(o=Math.min(p-u,d),s=0;s<=o;s++)l=h-u,m=d-s,(f=y-(c=p-u-s))>=0&&(t=i([u,s,c],[l,m,f]))<=_&&(v+=t);return{p_value:v,comparison:v>r?0:e[0]-n[0]||(e[1]-row[1])/(d+1)}},o});
//# sourceMappingURL=ludorum-player-assess.min.js.map