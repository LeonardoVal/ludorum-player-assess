//! ludorum-player-assess 0.0.1

(function(e){"use strict";"function"==typeof define&&define.amd?define(["creatartis-base","sermat","ludorum"],e):"object"==typeof exports&&module.exports?module.exports=e(require("creatartis-base"),require("sermat"),require("ludorum")):this["ludorum-player-assess"]=e(this.base,this.Sermat,this.ludorum)}).call(this,function e(n,r,t){"use strict";var a=n.raiseIf,o={__package__:"ludorum-player-assess",__name__:"ludorum_player_assess",__init__:e,__dependencies__:[n,r],ludorum:t,__SERMAT__:{include:[n,t]},compare:function(e){a(!e||!e.game,"Missing `game` argument!");var r,o=e.game,u=e.players||[new t.players.RandomPlayer({name:"RandomPlayer"})],s=e.opponents||[new t.players.RandomPlayer({name:"RandomOpponent"})],i=+e.matchCount||400,c=e.logger,l=u.map(function(e){return new t.tournaments.Measurement(o,e,s,i)});if(c){c.info("Starting "+i*u.length*2+" matches of "+o.name+".");var m=0;l.forEach(function(e){e.events.on("afterMatch",function(){m++})}),r=setInterval(function(){c.info("Played "+m+"/"+i*u.length*2+" matches.")},e.logTime||2e4)}return n.Future.all(l.map(function(e){return e.run()})).then(function(){return l.map(function(e,r){var t=e.statistics,a=u[r],s=n.iterable(o.players).map(function(e){return[e,[t.count({key:"victories",role:e,player:a.name}),t.count({key:"draws",role:e,player:a.name}),t.count({key:"defeats",role:e,player:a.name})]]}).toObject();return s.player=a.name,s})}).then(function(e){return c&&(clearInterval(r),c.info("Played "+m+"/"+i*u.length*2+" matches.")),e})}},u=o.hypergeometricRule=function(e,n){var r=0,t=[0,0],a=e.map(function(e,a){return t[0]+=e,t[1]+=n[a],r+=e+n[a],e+n[a]}),o=new Array(r+1);t.concat(a).forEach(function(e){for(var n=2;n<=e;n++)o[n]=1+(0|o[n])}),[r].concat(e,n).forEach(function(e){for(var n=2;n<=e;n++)o[n]=(0|o[n])-1});for(var u=1,s=2,i=2;s<=r||i<=r;)u<=1&&s<=r?(o[s]>0&&(u*=Math.pow(s,o[s])),s++):(o[i]<0&&(u*=Math.pow(i,o[i])),i++);return u};return o.fisher2x2=function(e,n,r){a(2!==e.length||2!==n.length,"Contingency table should be 2x2!"),r=isNaN(r)?.05:+r;var t=e[0],o=e[1],s=n[0],i=n[1],c=t+o,l=s+i,m=t+s,f=o+i,p=Math.abs(t/c-s/l),h=Math.min(m,c),d=0;for(t=0;t<=h;t++)s=m-t,i=f-(o=c-t),Math.abs(t/c-s/l)>=p&&(d+=u([t,o],[s,i]));return{p_value:d,comparison:d>r?0:e[0]-n[0]}},o.fisher2x3=function(e,n,r){a(3!==e.length||3!==n.length,"Contingency table should be 2x3!"),r=isNaN(r)?.05:+r;var t,o=e[0],s=e[1],i=e[2],c=n[0],l=n[1],m=n[2],f=o+s+i,p=o+c,h=s+l,d=i+m,y=u([o,s,i],[c,l,m]),_=0;for(o=0;o<=f;o++)for(s=0;s<=f-o;s++)(t=u([o,s,i=f-o-s],[c=p-o,l=h-s,m=d-i]))<=y&&(_+=t);return{p_value:_,comparison:_>r?0:e[0]-n[0]||(e[1]-row[1])/(h+1)}},o});
//# sourceMappingURL=ludorum-player-assess.min.js.map